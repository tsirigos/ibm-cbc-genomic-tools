#!/bin/tcsh

##
## USAGE: create_downloads VERSION [ARCHITECTURE=redhat-x86_64]
##
## NOTE: run from the bin directory
##

if ($#argv < 1) then
  usage $0
  exit
endif

set VERSION = $1
set ARCH = $2
if ($ARCH == "") then
  set ARCH = redhat-x86_64
endif

set REPODIR = `get_prog_dir $0`/..
set DIR = genomic-tools-$VERSION

cd ~
ln -sf $REPODIR $DIR

echo "Creating source/documentation/examples archive..."
cd $DIR
cd src
make clean
cd ~
tar --wildcards-match-slash --exclude="*\/\.svn" -cvzf genomic-tools-$VERSION-src.tgz $DIR/Makefile $DIR/README $DIR/bin $DIR/src
tar --wildcards-match-slash --exclude="*\/\.svn" -cvzf genomic-tools-$VERSION-src+doc+examples.tgz $DIR/Makefile $DIR/README $DIR/bin $DIR/doc $DIR/examples $DIR/src

echo "Compiling..."
cd $DIR
cd src
make clean
make -f Makefile.static
echo

echo "Creating precompiled archive..."
cd ~
tar --exclude="copy_source" --exclude="create_downloads" -cvzf genomic-tools-$VERSION-$ARCH.tgz $DIR/bin/*
echo


echo "Done."

